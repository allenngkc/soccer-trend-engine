// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// Enums
enum MatchStatus {
  scheduled
  finished
}

enum MatchResult {
  W  // Win
  D  // Draw
  L  // Loss
}

// Models
model Team {
  id        Int      @id @default(autoincrement())
  name      String
  country   String?
  league    String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  homeMatches    Match[]          @relation("HomeTeam")
  awayMatches    Match[]          @relation("AwayTeam")
  teamMatchStats TeamMatchStats[]
}

model Match {
  id          Int         @id @default(autoincrement())
  competition String      // e.g., "EPL"
  season      String      // e.g., "2024-2025"
  matchDate   DateTime
  homeTeamId  Int
  awayTeamId  Int
  homeGoals   Int?
  awayGoals   Int?
  status      MatchStatus @default(scheduled)
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  // Relations
  homeTeam       Team             @relation("HomeTeam", fields: [homeTeamId], references: [id])
  awayTeam       Team             @relation("AwayTeam", fields: [awayTeamId], references: [id])
  teamMatchStats TeamMatchStats[]

  @@index([competition, season, matchDate])
}

model TeamMatchStats {
  id            Int         @id @default(autoincrement())
  matchId       Int
  teamId        Int
  isHome        Boolean
  goalsFor      Int
  goalsAgainst  Int
  result        MatchResult
  possession    Float?      // 0-100
  corners       Int?
  shots         Int?
  shotsOnTarget Int?
  xg            Float?      // Expected goals
  xga           Float?      // Expected goals against
  fouls         Int?
  yellow        Int?
  red           Int?
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt

  // Relations
  match Match @relation(fields: [matchId], references: [id])
  team  Team  @relation(fields: [teamId], references: [id])

  @@unique([matchId, teamId])
  @@index([teamId, matchId])
  @@index([teamId])
}
